# PR #83 Comments (sourced from provided screenshots)

- **mateeullahmalik**: â€œNo description provided.â€

- **roomote (general review)**: Asked why only `CpuCoresTotal`, `MemTotalGb`, and `DiskTotalGb` are validated as strictly positive; suggested adding nonâ€‘negative checks for `UptimeSeconds`, `PeersCount`, `DiskFreeGb`, and `MemFreeGb` to ensure data integrity. Noted `SupernodeMetrics` uses `uint32` for `PeersCount`/`OpenPorts` while `SupernodeMetricsState` uses `uint64` for `ReportCount` and `int64` for `Height`; `metrics.proto` has `PeersCount` as `uint32` and the generated `x/supernode/v1/types/metrics.pb.go` matches. Pointed out `m.PeersCount` is accessed but not validated in `evaluateCompliance` and suggested ensuring it is not excessively large or invalid. Flagged `m.UptimeSeconds` (`float64`) should be validated to be nonâ€‘negative. Observed `m.CpuUsagePercent`, `m.MemUsagePercent`, and `m.DiskUsagePercent` are checked for 0â€“100, but `m.CpuCoresTotal`, `m.MemTotalGb`, and `m.DiskTotalGb` are only checked against minimums; recommended guarding against Inf/NaN (noting `checkFinite` only adds issues). Warned `UptimeSeconds` and `PeersCount` currently have no checks and should be finite and â‰¥ 0. Also highlighted that `HandleMetricsStaleness` iterates over all supernodes and could be a performance issue; suggested indexing or sampling if counts grow.

- **roomote â€” x/supernode/v1/keeper/metrics_validation.go (lines 110â€“113)**: â€œIs there a specific reason why only `CpuCoresTotal`, `MemTotalGb` and `DiskTotalGb` are validated to be strictly positive (> 0)? Other values like `UptimeSeconds` and `PeersCount` should also likely be non-negative, although their type `float64` allows negative values. Also `DiskFreeGb` and `MemFreeGb` shouldn't be negative. Consider adding checks for these fields as well to ensure data integrity.â€

- **roomote â€” x/supernode/v1/keeper/metrics_validation.go (lines 110â€“113)**: â€œ`SupernodeMetrics` struct uses `uint32` for `PeersCount` and `OpenPorts`. However, `SupernodeMetricsState` uses `uint64` for `ReportCount` and `int64` for `Height`. It is fine, but in `metrics.proto` file `PeersCount` is `uint32`. The `SupernodeMetrics` struct in `x/supernode/v1/types/metrics.pb.go` correctly reflects this. However, in `evaluateCompliance` in `x/supernode/v1/keeper/metrics_validation.go`, `m.PeersCount` is accessed but not validated. It is implicitly >= 0 because it is unsigned, but maybe we should ensure it's not excessively large or 0 if that's invalid? More importantly, `m.UptimeSeconds` is a `float64`. This should probably be validated to be non-negative.â€

- **roomote â€” x/supernode/v1/keeper/metrics_validation.go (lines 110â€“113)**: â€œIt seems that `m.CpuUsagePercent`, `m.MemUsagePercent` and `m.DiskUsagePercent` are validated to be between 0 and 100. But `m.CpuCoresTotal`, `m.MemTotalGb` and `m.DiskTotalGb` are only checked against the minimum requirements. It might be safer to also check they are not infinity or NaN, which is done by `checkFinite`, but `checkFinite` adds to issues but doesn't return or stop execution. So subsequent checks like `if m.CpuCoresTotal < params.MinCpuCores` might still run with NaN or Inf if they weren't caught/returned early. Although `m.CpuCoresTotal < params.MinCpuCores` handles Inf correctly (Inf is not < finite), NaN comparisons always yield false, so NaN < `MinCpuCores` is false, which might bypass the check if we rely only on the < check. But `checkFinite` adds an issue for NaN, so that's good. However, for `UptimeSeconds` and `PeersCount`, there are no checks at all. `UptimeSeconds` should be finite and >= 0.â€

- **roomote â€” x/supernode/v1/keeper/metrics_staleness.go (lines 18â€“21)**: â€œThe `HandleMetricsStaleness` function iterates over ALL supernodes. This could be a performance issue if there are many supernodes. Consider if we can optimize this, perhaps by using an index or only checking a subset per block, or if the number of supernodes is expected to be small enough.â€

- **chatgpt-codex-connector â€” proto/lumera/supernode/v1/tx.proto (lines 93â€“97)**: â€œRegister `MsgReportSupernodeMetrics` in interfaces. The new `MsgReportSupernodeMetrics` message added here is not registered as an `sdk.Msg` in `x/supernode/v1/types/codec.go` (`RegisterInterfaces` only lists register/deregister/start/stop/update/update_params). Without that registration the interface registry cannot encode or decode this message, so any transaction trying to broadcast supernode metrics will fail at signing/Tx processing with an â€˜unregistered interfaceâ€™ error. Please add `MsgReportSupernodeMetrics` to the sdk.Msg registrations so clients can submit metrics reports. Useful? React with ğŸ‘ / ğŸ‘.â€
